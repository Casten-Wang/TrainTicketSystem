{% extends "bootstrap/base.html" %}
{% block content %}
    <!DOCTYPE html>
    <html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="/statics/css/main.css">
        <link rel="stylesheet" href="/statics/css/nav.css">
        <script src="/statics/js/Add.js"></script>
    </head>

    <body>
    <ul>
        <li><a href="/bank_add/{{ name }}">余额：{{ balance }}</a></li>
        <li style="float:right"><a href="#about">个人资料</a></li>
        <li style="float:right"><a href="/user/regist">返回注册</a></li>
        <li style="float:right"><a href="/user/login">返回登录</a></li>
    </ul>
    <div id="container">
        <!-- 背景黑色遮罩 -->
        <div id="hidden"></div>
        <div id="box">
            <strong id="close">关闭</strong>
            <form id="buy_form" method="POST" action="/main/{{ name }}/buy" onsubmit="return checkForm()">
                <span>
                    <input id="input1" name="train" type="text" style="display: none" placeholder="车次号">
                </span>
                <span>
                    <input id="input2" name="begintime" type="text" style="display: none" placeholder="出发时间">
                </span>
                <span>
                    <input id="input3" name="endtime" type="text" style="display: none" placeholder="到达时间">
                </span>
                <span>
                    <input id="input4" name="price" type="text" style="display: none" placeholder="票价">
                </span>
                <input type="submit" value="购票" id="buy">
            </form>
        </div>
    </div>
    <form class="form-inline" action="/main/{{ name }}">
        <div class="form-group">
            <label>出发地</label>
            <input name="origin" type="text" value="" required="">
        </div>
        <div class="form-group">
            <label>目的地</label>
            <input name="destination" type="text" value="" required="">
        </div>
        <div class="form-group">
            <label>出发日期</label>
            <input name="begintime" type="date" value="" required="">
        </div>
        <div class="form-group">
            <button type="submit">查询</button>
        </div>
    </form>
    <table id="table_result" class="table table-bordered table-hover">
        <tr>
            <th>
                车次号
            </th>
            <th>
                可载人数
            </th>
            <th>
                出发时间
            </th>
            <th>
                到达时间
            </th>
            <th>
                出发地
            </th>
            <th>
                目的地
            </th>
            <th>
                票价
            </th>
            <th>
                操作
            </th>
        </tr>
        {% for i in content %}
            <tr>
                {% for j in i[0:-1] %}
                    <td>{{ j }}</td>
                {% endfor %}
                <td class="buybutton">
                    <button>订票</button>
                </td>
            </tr>
        {% endfor %}
    </table>
    <!-- 空的div用来放分页后的表格 -->
    <div id="barcon" name="barcon"></div>
    <script>
        var box = my$('box');
        var hidden = my$('hidden');
        var close = my$('close');
        var mybutton = document.getElementsByClassName("buybutton");
        for (var i = 0; i < mybutton.length; i++) {
            mybutton[i].onclick = function () {
                box.style.display = 'flex';
                hidden.style.display = 'block';
                var parent = this.parentNode;
                var brother1 = parent.children[0].innerText;
                var brother2 = parent.children[2].innerText;
                var brother3 = parent.children[3].innerText;
                var brother4 = parent.children[6].innerText;
                $("#input1").val(brother1);
                $("#input2").val(brother2);
                $("#input3").val(brother3);
                $("#input4").val(brother4);
                var form = document.getElementById('buy_form');
                var label = document.createElement("label");
                form.appendChild(label);
                t1 = "你购买的车次为：";
                t2 = "出发时间：";
                t3 = "到达时间：";
                t4 = "票价：";
                var text1 = document.createTextNode(t1 + brother1);
                var text2 = document.createTextNode(t2 + brother2);
                var text3 = document.createTextNode(t3 + brother3);
                var text4 = document.createTextNode(t4 + brother4);
                var ele1 = document.createElement("p");
                label.appendChild(ele1);
                ele1.appendChild(text1);
                var ele2 = document.createElement("p");
                label.appendChild(ele2);
                ele2.appendChild(text2);
                var ele3 = document.createElement("p");
                label.appendChild(ele3);
                ele3.appendChild(text3);
                var ele4 = document.createElement("p");
                label.appendChild(ele4);
                ele4.appendChild(text4);
            }
        }
        close.onclick = function () {
            var paras = document.getElementsByTagName("label");
            for (i = 0; i < paras.length; i++) {
                //删除元素 元素.parentNode.removeChild(元素);
                if (paras[i] != null)
                    paras[i].parentNode.removeChild(paras[i]);
            }
            box.style.display = 'none';
            hidden.style.display = 'none';
            box.style.top = '200px';
            box.style.left = '';
        }

        function checkForm() {
            var form = document.getElementById('buy_form');
            form.submit();
        }

        var buy = document.getElementById("buy");
        buy.onclick = function () {
            alert("购票成功");
        }
    </script>
    <script>
        goPage(1, 14);

        function goPage(pno, psize) {
            var itable = document.getElementById("table_result"); //通过ID找到表格
            var num = itable.rows.length; //表格所有行数(所有记录数)
            var totalPage = 0; //总页数
            var pageSize = psize; //每页显示行数
            //总共分几页
            if (num / pageSize > parseInt(num / pageSize)) {
                totalPage = parseInt(num / pageSize) + 1;
            } else {
                totalPage = parseInt(num / pageSize);
            }
            var currentPage = pno; //当前页数
            var startRow = (currentPage - 1) * pageSize + 1; //开始显示的行  1
            var endRow = currentPage * pageSize; //结束显示的行   15
            endRow = (endRow > num) ? num : endRow;
            //遍历显示数据实现分页
            for (var i = 1; i < (num); i++) {
                var irow = itable.rows[i];
                if (i >= startRow && i <= endRow) {
                    irow.style.display = "table-row";
                } else {
                    irow.style.display = "none";
                }
            }

            var tempStr = "";
            if (currentPage > 1) {
                tempStr += "<a href=\"#\" onClick=\"goPage(" + (currentPage - 1) + "," + psize +
                    ")\"><上一页&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a>"
                for (var j = currentPage - 1; j <= currentPage + 8; j++) {
                    if (j > 0 && j <= totalPage) {
                        tempStr += "<a href=\"#\" onClick=\"goPage(" + j + "," + psize + ")\">" + j +
                            "&nbsp;&nbsp;&nbsp;</a>";
                    }
                }
            } else {
                tempStr += "<a> <上一页&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a>";
                for (var j = 1; j <= 10; j++) {
                    tempStr += "<a href=\"#\" onClick=\"goPage(" + j + "," + psize + ")\">" + j +
                        "&nbsp;&nbsp;&nbsp;</a>"
                }
            }
            if (currentPage < totalPage) {
                tempStr += "<a href=\"#\" onClick=\"goPage(" + (currentPage + 1) + "," + psize +
                    ")\">下一页>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a>";
                for (var j = 1; j <= totalPage; j++) {
                }
            } else {
                tempStr += "  下一页>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
                for (var j = 1; j <= totalPage; j++) {
                }
            }
            document.getElementById("barcon").innerHTML = tempStr;
            // itable.rows[0].style.display = "block";
        }
    </script>
    <script>
        var open = my$('open');
        var box = my$('box');
        var hidden = my$('hidden');
        var close = my$('close');
        open.onclick = function () {
            box.style.display = 'flex';
            hidden.style.display = 'block';
        }
        close.onclick = function () {
            box.style.display = 'none';
            hidden.style.display = 'none';
            box.style.top = '200px';
            box.style.left = '';
        }
    </script>
    </body>

    </html>
{% endblock %}